KDE
________________________________________________________________________________

KDE [0] is desktop environment which consists of the Plasma Desktop, the KDE 
Frameworks, and a collection of free and open source, cross-platform programs.
The project makes integral use of the Qt framework [1] to help provide a 
uniform experience for users between all of the software a user will install.

$/dilyn-corner/KISS-kde is still considered to be under heavy development. While
the desktop environment works quite well, many things have yet to be tested. If
you run into bugs, problems, or have suggestions, submit issues or pull requests
on the GitHub page!

Note that, due to the KISS Guidestones [2], the $/dilyn-corner/KISS-kde project
is entirely community maintained. It will always remain separate from the core
KISS project, including the community repository. Specifically, KDE violates the
software inclusion guidestone. The required violations are dbus and wayland. 
However, logind and pam are optional requirements to install and use KDE. 


Index
________________________________________________________________________________

- Getting Started                                                          [0.0]

- From Scratch                                                             [1.0]
    - Prerequisites                                                        [1.1]
    - Installing                                                           [1.2]

- The KISS-kde tarball                                                     [2.0]

- Starting KDE                                                             [3.0]
    - Console                                                              [3.1]
    - Login Manager                                                        [3.2]

- Post-Install                                                             [4.0]
    - kwinft                                                               [4.1]
    - sddm                                                                 [4.2]
    - Extras                                                               [4.3]

- How You Can Help                                                         [5.0]
- References                                                               [6.0]


[0.0] Getting Started
________________________________________________________________________________

To begin using the K Desktop Environment there are two choices. The first option
is to use a prebuilt tarball similar to the KISS release tarballs and install it
analogously to how one installs KISS. The second is to build every package from
source from an existing KISS installation or from a Live CD.


[1.0] From Scratch
________________________________________________________________________________

KDE can also be installed from an existing KISS installation. While this
method takes far longer, it offers more fine-grained control on the overall
system. The use of your own C(XX)FLAGS, smaller packages (e.g. mesa), as
as well as choosing $KISS_ROOT. 

You have two choices on what to install: plasma-desktop or plasma. Building 
plasma-desktop will pull in the minimum required dependencies for a working 
KDE environment, plus a few extra niceities such as a system settings manager, 
the breeze icon theme, and fonts. Alternatively, plasma is a meta-package that 
includes things like an info center, a bug/crash reporting framework, additional
plasma wallpapers, and bluedevil. It's basically KDE with all of the frills. Opt
for plasma-desktop if you only want to selectively include these. For instance
if you know you will not need bluetooth, you have no need for bluedevil. 


    [1.1] Prerequisites
    ____________________________________________________________________________

    First, fetch the required repositories and add them to your $KISS_PATH. Omit
    any repositories you already have, just ensure that community comes AFTER
    KISS-kde/extra. These repositories may be stored anywhere; assume they are
    in $HOME.

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ git clone https://github.com/kisslinux/community                     |
    |   $ git clone https://github.com/dilyn-corner/KISS-kde                   |
    |                                                                          |
    |   $ export KISS_PATH="$HOME/KISS-kde/extra:$KISS_PATH"                   |
    |   $ export KISS_PATH="$HOME/KISS-kde/plasma:$KISS_PATH"                  |
    |   $ export KISS_PATH="$HOME/KISS-kde/frameworks:$KISS_PATH"              |
    |   $ export KISS_PATH="$KISS_PATH:$HOME/community/community"              |
    |                                                                          |
    |   # you can optionally include the kde path for sddm, dolphin, etc.      |
    |   $ export KISS_PATH="$KISS_PATH:$HOME/KISS-kde/kde"                     |    
    |                                                                          |
    +--------------------------------------------------------------------------+

    Next, enure that you have the proper required packages installed:
    libudev-zero and dbus. libudev-zero has been tested to work with KDE.
    Optionally, eudev also works. The choice is up to you! Currently,
    dbus-alternatives (like a stub library) are untested.
    
    Note: Currently, in order to build plasma (not plasma-desktop), you will
    require coreutils. Specifically, elogind, libblockdev, and udisks2 require
    three separate programs. Patches are welcome to resolve this!
    coreutils provides files which conflict with other KISS packages, such as 
    busybox. To ensure we are using the correct programs when we attempt to 
    build plasma, we use the alternatives system! For more information on this 
    system, see [4].

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss b libudev-zero dbus                                             |
    |   $ kiss i libudev-zero dbus                                             |
    |   # If you opt to install plasma instead of plasma-desktop,              |
    |   $ kiss b coreutils && kiss i coreutils                                 |
    |   $ kiss a coreutils /usr/bin/realpath                                   |
    |   $ kiss a coreutils /usr/bin/mktemp                                     |
    |   $ kiss a coreutils /usr/bin/ln                                         |
    |                                                                          |
    +--------------------------------------------------------------------------+

    Note that if you currently have packages like xorg-server installed, you
    might want to rebuild them to pickup on the new device manager they can take 
    advantage of. If you do not currently have xorg-server installed, you will
    want to get it. A pure wayland KDE is both untested and unlikely to work.
    Note: with the release of plasma 5.20.0, KDE is defaulting to a wayland
    environment. xorg support may be dropped in the future!

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss b xorg-server libinput xf86-input-libinput                      |
    |   $ kiss i xorg-server libinput xf86-input-libinput                      |
    |                                                                          |
    +--------------------------------------------------------------------------+

    Make sure you do not currently have qt5 installed. The build files have been
    tweaked for this repository to make use of dbus and libudev-zero. As a 
    result, carrying over the community version of these packages will lead to 
    unknown problems.
    Because of the time required to build qt5* packages, some prebuilt tarballs
    are available on the Github repository [3]. The current release is 5.15.1,
    available with the 2020.10-1 release of KISS-kde

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ ver=2020.10-1                                                        |
    |   $ qtver=5.15.1-1                                                       | 
    |   $ url=https://github.com/dilyn-corner/KISS-kde/releases/download/$ver  |
    |                                                                          |
    |   $ wget $url/qt5.$qtver.tar.gz \                                        |
    |          -O qt5@$qtver.tar.gz                                            |
    |   $ wget $url/qt5-declarative.$qtver.tar.gz \                            |
    |         -O qt5-declarative@$qtver.tar.gz                                 |
    |   # Not a build-time requirement, but useful for e.g. falkon             |
    |   $ wget $url/qt5-webengine.$qtver.tar.gz \                              |
    |          -O qt5-webengine@$qtver.tar.gz                                  |
    |                                                                          |
    +--------------------------------------------------------------------------+

    It is recommended to verify the checksums for these tarballs to ensure
    package integrity!

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ wget $url/qt5.$qtver.tar.gz.sha256                                   |
    |                                                                          |
    |   $ sha256sum -c < qt5@$qtver.tar.gz                                     |
    |   $ sha256sum -c < qt5-declarative@$qtver.tar.gz                         |
    |   $ sha256sum -c < qt5-webengine@$qtver.tar.gz                           |
    |                                                                          |
    +--------------------------------------------------------------------------+

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss i qt5@$qtver.tar.gz                                             |
    |   $ kiss i qt5-declarative@$qtver.tar.gz                                 |
    |   $ kiss i qt5-webengine@$qtver.tar.gz                                   |
    |                                                                          |
    +--------------------------------------------------------------------------+

    NOTE: In general, it is a security risk to install prebuilt packages. these
    archives are provided as a courtesy by $/dilyn-corner. Always verify the
    authenticity of packages, and the identities of packagers!


    [1.2] Installing
    ____________________________________________________________________________

    Now that all of the build requirements are taken care of, we can install 
    the desktop environment. Make your choice between plasma-desktop or plasma, 
    and build them by

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss b plasma-desktop && kiss i plasma-desktop                       | 
    |                                                                          |
    +--------------------------------------------------------------------------+

    Optionally, enable and start the dbus service:

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ ln -s /etc/sv/dbus /var/service                                      |
    |   $ sv up dbus                                                           |
    |                                                                          |
    +--------------------------------------------------------------------------+

No services are required to be running in order to start a plasma session.


[2.0] The KISS-kde tarball
________________________________________________________________________________

Similarly to KISS itself, a tarball containing a fully-functional KISS with
KDE setup is available from the GitHub repository [3]. This archive can be
chrooted into or directly unpacked to '/'. Note that it is ~400MB in size.
It is built from a kiss-chroot archive with identical generic C(XX)FLAGS. 

NOTE: In general, it is a security risk to install prebuilt packages. This
archive is provided as a courtesy by $/dilyn-corner. Always verify the
authenticity of packages, and the identities of packagers!

The KISS-kde archive is a fully installed version of plasma-desktop. See [1.0]
for the distinction between plasma-desktop and plasma.

There will be monthly releases of the KISS-kde tarball to keep up with upstream. 
The format of releases will be in YYYY-MM format.

To download e.g. the October 2020 release, 

+------------------------------------------------------------------------------+
|                                                                              |
|   $ ver=2020.10-1                                                            |
|   $ url=https://github.com/dilyn-corner/KISS-kde/releases/download/$ver      |
|   $ wget $url/kiss-kde-$ver.tar.xz                                           |
|                                                                              |
+------------------------------------------------------------------------------+
    
It is strongly recommended to verify the checksums to avoid problems like
using a partially downloaded archive.

+------------------------------------------------------------------------------+
|                                                                              |
|   $ wget $url/kiss-kde-$ver.tar.xz.sha256                                    |
|   $ sha256sum -c < kiss-kde-$ver.tar.xz.sha256                               |
|                                                                              |
+------------------------------------------------------------------------------+

After setting up your disks, mount your desired root partition to '/mnt' and
to install the latest release,

+------------------------------------------------------------------------------+
|                                                                              |
|   $ tar xf kiss-kde-$ver.tar.xz -C /mnt                                      |
|                                                                              |
+------------------------------------------------------------------------------+

and enter the chroot environment,

+------------------------------------------------------------------------------+
|                                                                              |
|   $ ./mnt/bin/kiss-chroot /mnt                                               |
|                                                                              |
+------------------------------------------------------------------------------+

The only remaining work to be done is creating a kernel, choosing a
bootloader, and adding users. For help with kernels, see @/kernel. For help
with bootloaders, see @/boot. 

Refer to the official installation guide [5] for important things to do, such as
user management, changing your hostname, etc.

NOTE: Please ensure you have cgroup support enabled in your kernel [6] if you
have chosen to install elogind!

It is recommended that you change the root password; the default is "toor".

If you would like to start a wayland session instead of an X session, swap which
line is (un)commented in /root/.xinitrc:

+------------------------------------------------------------------------------+
|                                                                              |
|   $ vi $HOME/.xinitrc                                                        |
|   $ startx                                                                   |
|                                                                              |
+------------------------------------------------------------------------------+

Finally, 

+------------------------------------------------------------------------------+
|                                                                              |
|   $ exit                                                                     |
|   $ reboot                                                                   |
|   $ startx                                                                   |
|                                                                              |
+------------------------------------------------------------------------------+

You should now be greeted with a fresh Plasma Desktop!


[3.0] Starting KDE
________________________________________________________________________________

You have two choices on how to launch KDE. Either you can start it directly from
the console, or you can make use of a login manager. 


    [3.1] Console
    ____________________________________________________________________________

    Launching a KDE session directly from the console is very straightforward.
    If you would like to use wayland instead of X, replace x11 by wayland in the
    below command.
    Simply add a line to your xinitrc file:

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ launch="exec dbus-launch --exit-with-session startplasma-x11"        |
    |   $ echo "$launch" >> "$HOME/.xinitrc"                                   |
    |                                                                          |
    +--------------------------------------------------------------------------+


    [3.2] Login Manager
    ____________________________________________________________________________

    The KISS-kde repository also includes sddm [7], the Simple Desktop Display
    Manager, as an option for a login manager. It requires a login manager.
    elogind is the default; other options are currently being tested.
    First, build and install elogind

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss b elogind && kiss i elogind                                     |
    |   # So that polkit will build the correct libs to support elogind,       |
    |   $ kiss b polkit && kiss i polkit                                       |
    |                                                                          |
    +--------------------------------------------------------------------------+

    Then, install sddm
    
    +--------------------------------------------------------------------------+
    |                                                                          |
    |   # sddm is in the KISS-kde/kde repo                                     |
    |   $ kiss b sddm && kiss i sddm                                           |
    |                                                                          |
    +--------------------------------------------------------------------------+

    NOTE: by default, it may not be possible for root to login via sddm. Best
    practices would dictate that you login as a unprivileged user.
    
    Enable the requisite services for sddm to function properly
    
    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ ln -s /etc/sv/polkitd /var/service                                   |
    |   $ ln -s /etc/sv/elogind /var/service                                   |
    |   $ ln -s /etc/sv/sddm    /var/service                                   |
    |                                                                          |
    |   $ sv up polkitd                                                        |
    |   $ sv up elogind                                                        |
    |   $ sv up sddm                                                           |
    |                                                                          |
    +--------------------------------------------------------------------------+

    If everything went well, sddm should immediately launch after you start the
    sddm service.


[4.0] Post-Install
________________________________________________________________________________

Everything you do from here on is to customize your new Plasma Desktop to your
own needs! No further setup or configuration is required. However, there are a
few things available to you that you can change, if you so choose.


    [4.1] kwinft
    ____________________________________________________________________________

    kwinft [8] is a composited window manager for X11 and Wayland systems. Most
    of the differences between kwinft and kwin are in the underlying code;
    kwinft is designed to have better coding practices and be well-organized.
    However, any features that appear in kwinft can be expected to eventually
    show up in kwin. So if you prefer a more bleeding edge, potentially better
    window manager for KDE, kwinft is an option. You can either swap to kwinft
    from an existing KDE install or start immediately with using it. All you are
    required to do is uncomment the kwinft lines in the dependencies list of
    plasma-{desktop,workspace}, and comment out kwin in the same packages. Then,

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ pkill X                                                              |
    |                                                                          |
    |   $ KISS_FORCE=1 kiss r kwin kwayland-server                             |
    |                                                                          |
    |   $ kiss b kwinft && kiss i kwinft                                       |
    |                                                                          |
    |   $ kiss b plasma-workspace && kiss i plasma-workspace                   |
    |   $ kiss b plasma-desktop   && kiss i plasma-desktop                     |
    |                                                                          |
    |   $ startx                                                               |
    |                                                                          |
    +--------------------------------------------------------------------------+


    [4.2] sddm
    ____________________________________________________________________________

    sddm can be configured quite heavily. Configuration is read from
    /etc/sddm.conf. If it does not exist, you can generate it: 

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ sddm --example-config >> /etc/sddm.conf                              |
    |                                                                          |
    +--------------------------------------------------------------------------+

    You can manually edit this file to allow for autologins, changing themes,
    changing the user icons, or even changing the range of UIDs that can login
    through sddm. 

    Alternatively, configuration can be done graphically during a plasma
    session. Simply install sddm-kcm and a sddm configuration section in 
    systemsettings should become available.

    +--------------------------------------------------------------------------+
    |                                                                          |
    |   $ kiss b sddm-kcm && kiss i sddm-kcm                                   |
    |                                                                          |
    +--------------------------------------------------------------------------+


    [4.3] Extras
    ____________________________________________________________________________

    Many things are included in KISS-kde/extra. Most exist as supplements to
    items in the framework or plasma, but many are for KDE Applications. 
    However, there are a few that might be of interest to most users. This
    includes kvantum (a robust theme engine) [9], sddm (a login manager), and 
    latte-dock (a dock app) [10].

    Separate from these are the KDE Applications, such as krita or dolphin.
    These are located in KISS-kde/kde. Add the repository to your $KISS_PATH
    in order to install them! Some useful (and working) applications include
    dolphin and konsole. Over time, the list of working KDE Applications should
    grow!


[5.0] How You Can Help
________________________________________________________________________________

The KISS-kde project is always looking for more contributors. Whether it is
fixing build errors, submitting patches, or adding applications, every
contribution is welcome!

For a current list of project milestones, check out the first section of the
README at $/dilyn-corner/KISS-kde.


[6.0] References
________________________________________________________________________________

[0] https://kde.org
[1] https://qt.io
[2] https://k1ss.org/guidestones
[3] https://github.com/dilyn-corner/KISS-kde/releases
[4] https://k1ss.org/package-manager#3.2
[5] https://k1ss.org/install
[6] http://linuxfromscratch.org/blfs/view/svn/general/elogind.html 
[7] https://wiki.archlinux.org/index.php/SDDM
[8] https://gitlab.com/kwinft/kwinft
[9] https://github.com/tsujan/Kvantum
[10] https://github.com/KDE/latte-dock
